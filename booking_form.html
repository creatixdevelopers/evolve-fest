<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Evolve Fest Registration</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      .error {
        color: #ff761c;
      }
      input.error,
      select.error,
      textarea.error,
      input.error:focus,
      select.error:focus,
      textarea.error:focus {
        border-bottom-color: #ff761c !important;
      }
      .spinner-border {
        width: 1.5rem;
        height: 1.5rem;
        vertical-align: middle;
      }
    </style>
  </head>
  <body style="background-color: #f7f6fa">
    <header>
      <div class="evolve_navbar container-fluid">
        <div class="evolve_logo d-flex align-items-center gap-3">
          <span id="hamburger" class="hamburger">
            <i class="fa-solid fa-bars"></i>
          </span>
          <a href="index.html">
            <img src="assets/img/evolvefest_logo_1.png" alt="evolve_logo" />
          </a>
        </div>
        <ul class="main_menu" id="main_menu">
          <li class="menu_item"><a href="#evolvefest_home" class="menu_link active">home</a></li>
          <li class="menu_item"><a href="#evolvefest_about" class="menu_link">about</a></li>
          <li class="menu_item"><a href="#evolvefest_pillars" class="menu_link">pillars</a></li>
          <li class="menu_item"><a href="#evolvefest_schedule" class="menu_link">schedule</a></li>
          <li class="menu_item"><a href="#evolvefest_ashram" class="menu_link">ashram</a></li>
          <li class="menu_item"><a href="#evolvefest_location" class="menu_link">location</a></li>
        </ul>
        <button type="submit" class="btn evol_primary_btn_md">register now</button>
      </div>
    </header>

    <div class="booking_form">
      <div class="form_main container">
        <h4>Welcome to changemaker</h4>
        <p>The Evolve Fest - A Spiritual Retreat For Youth | Tirupati | September 19-21, 2025</p>
        <br />
        <form id="bookingForm" enctype="multipart/form-data">
          <div class="row">
            <div class="col-md-6 mb-3"><label>First Name</label><input type="text" name="first_name" class="form-control" required /></div>
            <div class="col-md-6 mb-3"><label>Last Name</label><input type="text" name="last_name" class="form-control" required /></div>
            <div class="col-md-6 mb-3"><label>Email</label><input type="email" name="email" class="form-control" required /></div>
            <div class="col-md-6 mb-3"><label>Mobile Number</label><input type="tel" name="mobile_number" class="form-control" required /></div>
            <div class="col-md-6 mb-3">
              <label>Country</label>
              <select name="country" id="country" class="form-select" required>
                <option value="">Loading countries...</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label>State</label>
              <select name="state" id="state" class="form-select" required>
                <option value="">Select country first</option>
              </select>
            </div>
            <div class="col-md-6 mb-3"><label>City</label><input type="text" name="city" class="form-control" required /></div>
            <div class="col-md-12 mb-3">
              <label>Gender</label><br />
              <label><input type="radio" name="gender" value="Male" required /> Male</label>
              <label class="ms-3"><input type="radio" name="gender" value="Female" required /> Female</label>
            </div>
            <div class="col-md-12 mb-3">
              <label>Upload Photo (Max 5MB)</label>
              <input type="file" name="file" id="fileInput" class="form-control" accept="image/*" required />
            </div>
            <div class="col-md-12 mb-3">
              <div class="evolve_terms">
                <div class="evolve_term">
                  <label class="cr-wrapper">
                    <input type="checkbox" name="agreed_rules_and_responsibilities" class="form-check-input" id="agreed_rules_and_responsibilities" />
                    <div class="cr-input"></div>
                    <span class="text-dark">I confirm my participation and agree to abide by the event rules & guidelines.</span>
                  </label>
                  <div id="agreed_rules_and_responsibilities_error"></div>
                </div>
                <div class="evolve_term">
                  <label class="cr-wrapper">
                    <input type="checkbox" name="agreed_own_travel" class="form-check-input" id="agreed_own_travel" />
                    <div class="cr-input"></div>
                    <span class="text-dark"
                      >I understand that travel to and from the Brahmrishi Ashram, Tirupathi, will be my own responsibility. Only stay arrangements<br />
                      and food during the event will be managed by the</span
                    >
                  </label>
                  <div id="agreed_own_travel_error"></div>
                </div>
                <div class="evolve_term">
                  <label class="cr-wrapper">
                    <input type="checkbox" name="agreed_to_use_my_photos" class="form-check-input" id="agreed_to_use_my_photos" />
                    <div class="cr-input"></div>
                    <span class="text-dark">I give permission for my photos/videos taken at the event to be used for promotional purposes.</span>
                  </label>
                  <div id="agreed_to_use_my_photos_error"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="text-center">
            <button type="submit" id="submitBtn" class="btn btn-primary">
              <span class="btn-text">Submit</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <footer class="evolve_footer">
      <div class="evolve_footer_content">
        <div class="evolve_footer_intro">
          <a href="index.html">
            <img src="assets/img/evolvefest_logo_2.png" alt="evolvefest_logo_2" />
          </a>
          <div class="footer_txt_content">
            <h4>Contact Us</h4>
            <div>Sri Brahmrishi Ashram, Tirupati,</div>
            <div class="d-flex gap-3 flex-wrap column-gap-3 row-gap-1 align-items-center"><a href="#" class="">Tel: +91 98765 43210</a><a href="#" class="">Mail: info@sbayuva.com</a></div>
            <div class="">Instagram: Sri Brahmrishi Ashram Yuva</div>
          </div>
        </div>
        <div class="footer_evlove_quote">
          <h4>“The journey within begins with a single breath”</h4>
          <p>- Sri Siddhguruvar</p>
        </div>
      </div>
      <div class="evolve_copyright">© <span id="current_year"></span> The Evolve Fest | Sri Brahmrishi Ashram. All rights reserved.</div>
    </footer>

    <script>
      const scriptURL = "https://script.google.com/macros/s/AKfycbxq8FctY1B6rCVJFlD0RgGUPtSDFJxSg9_Z4Cl6M-cwH_5KtyreCW4n-SnYpynWZaUv/exec";
      const form = document.getElementById("bookingForm");
      const fileInput = document.getElementById("fileInput");
      const submitBtn = document.getElementById("submitBtn");
      const spinner = submitBtn.querySelector(".spinner-border");
      const btnText = submitBtn.querySelector(".btn-text");

      document.addEventListener("DOMContentLoaded", () => {
        const countrySel = document.getElementById("country");
        const stateSel = document.getElementById("state");

        fetch("https://countriesnow.space/api/v0.1/countries/positions")
          .then((res) => res.json())
          .then((data) => {
            countrySel.innerHTML = '<option value="">Select country</option>';
            data.data.forEach((c) => {
              const opt = document.createElement("option");
              opt.textContent = c.name;
              opt.value = c.name;
              countrySel.appendChild(opt);
            });
          })
          .catch(() => {
            countrySel.innerHTML = '<option value="">Failed to load</option>';
          });

        countrySel.addEventListener("change", () => {
          const country = countrySel.value;
          stateSel.innerHTML = "<option>Loading states...</option>";

          fetch("https://countriesnow.space/api/v0.1/countries/states", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ country }),
          })
            .then((res) => res.json())
            .then((resp) => {
              const states = resp.data.states || [];
              stateSel.innerHTML = states.length ? '<option value="">Select state</option>' + states.map((s) => `<option value="${s.name}">${s.name}</option>`).join("") : '<option value="">No states available</option>';
            });
        });
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (fileInput.files.length === 0) {
          Swal.fire("Error", "Please upload a file.", "error");
          return;
        }

        const file = fileInput.files[0];
        if (file.size > 5 * 1024 * 1024) {
          Swal.fire("Error", "File size must be under 5MB.", "error");
          return;
        }

        btnText.classList.add("d-none");
        spinner.classList.remove("d-none");
        submitBtn.disabled = true;

        const email = form.querySelector('input[name="email"]').value;
        const timestamp = new Date()
          .toISOString()
          .replace(/[-:T.]/g, "")
          .slice(0, 14);
        const filename = `${email}_${timestamp}.${file.name.split(".").pop()}`;

        let fileUrl = "";
        await new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = function (event) {
            const base64Content = event.target.result.split(",")[1];
            const uploadData = new FormData();
            uploadData.append("mode", "upload");
            uploadData.append("filename", filename);
            uploadData.append("mimeType", file.type);
            uploadData.append("fileContent", base64Content);

            fetch(scriptURL, { method: "POST", body: uploadData })
              .then((res) => res.json())
              .then((result) => {
                fileUrl = result.fileUrl || "";
                resolve();
              })
              .catch((err) => {
                console.warn("Upload failed:", err);
                resolve();
              });
          };
          reader.readAsDataURL(file);
        });

        const formData = new FormData(form);
        formData.append("fileUrl", fileUrl);

        fetch(scriptURL, {
          method: "POST",
          body: formData,
        })
          .then(() => {
            Swal.fire("Success", "Form submitted successfully!", "success");
            form.reset();
          })
          .catch(() => {
            Swal.fire("Error", "Submission failed. Please try again.", "error");
          })
          .finally(() => {
            btnText.classList.remove("d-none");
            spinner.classList.add("d-none");
            submitBtn.disabled = false;
          });
      });
    </script>
  </body>
</html>
